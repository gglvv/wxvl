#  【必查漏洞】Sudo Host_Alias 权限提升漏洞 (CVE-2025-32462) 检测手册  
 安全狐   2025-07-01 15:45  
  
# CVE-2025-32462 检测与修复手册  
  
**漏洞名称**  
：Sudo Host_Alias 权限提升漏洞**影响版本**  
：Sudo 1.8.8 ~ 1.9.17  
## 1. 漏洞概述  
### 漏洞描述  
  
攻击者可通过滥用 Host_Alias  
 配置中的通配符或未验证主机名，结合 sudo -h  
 参数绕过权限限制，以 root  
 身份执行任意命令。  
### 漏洞原理  
- **错误逻辑**  
：Sudo 在验证 Host_Alias  
 时未严格检查主机名真实性。  
  
- **利用条件**  
：  
  
- sudoers  
 文件中存在宽松的 Host_Alias  
（如 *  
 或动态主机名）。  
  
- 用户权限配置包含 NOPASSWD  
 或 ALL  
 权限。  
  
### 受影响版本  
  
✅ **Sudo 1.8.8 至 1.9.17**  
  
❌ **已修复版本**  
：≥1.9.17p1  
## 2. 检测方法  
### 2.1 确认 Sudo 版本  
```
sudo --version | head -n 1
```  
  
**风险判定**  
：  
- 输出为 1.8.8  
 至 1.9.17  
 → **存在漏洞**  
  
### 2.2 检查危险配置  
```
# 搜索所有 Host_Alias 定义grep -r "Host_Alias" /etc/sudoers /etc/sudoers.d/ 2>/dev/null | grep -v "^#"# 检查关联权限规则grep -r -A5 "Host_Alias" /etc/sudoers /etc/sudoers.d/ 2>/dev/null | grep -v "^#"
```  
  
**危险特征**  
：  
- 使用通配符（如 Host_Alias ALLOWED_HOSTS = *  
）  
  
- 绑定宽松权限（如 %admin ALLOWED_HOSTS = (ALL) NOPASSWD: ALL  
）  
  
### 2.3 漏洞验证（PoC）  
```
# 测试命令（需普通用户权限）sudo -h nonexistenthost id
```  
  
**预期结果**  
：  
- 返回 uid=0(root)  
 → **漏洞存在**  
  
- 返回权限错误 → 可能已修复  
  
## 3. 修复方案  
### 3.1 升级 Sudo  
```
# Ubuntu/Debiansudo apt update && sudo apt install sudo=1.9.17p1-1# CentOS/RHELsudo yum update sudo-1.9.17p1
```  
### 3.2 修改危险配置  
```
sudo visudo
```  
  
**修复建议**  
：  
1. 删除或注释所有含通配符的 Host_Alias  
：```
# 原危险配置Host_Alias ALLOWED_HOSTS = *%admin ALLOWED_HOSTS = (ALL) NOPASSWD: ALL# 修复后（限制具体主机）Host_Alias SAFE_HOSTS = admin01,backup01%admin SAFE_HOSTS = (ALL) /usr/bin/apt
```  
  
  
1. 避免使用 NOPASSWD  
，改为密码验证。  
  
### 3.3 临时缓解措施  
```
# 禁用所有 Host_Alias 规则（紧急情况下）sudo sed -i '/Host_Alias/d' /etc/sudoers /etc/sudoers.d/*
```  
## 4. 监控与审计  
### 4.1 日志监控  
```
# 检查异常 sudo -h 使用记录grep "sudo -h" /var/log/auth.log /var/log/secure
```  
### 4.2 定期扫描  
```
# 自动化检测脚本#!/bin/bashVERSION=$(sudo --version | head -n1 | awk '{print $3}')if [[ "$VERSION" > "1.8.8" && "$VERSION" < "1.9.17" ]]; then  echo "⚠️  Vulnerable Sudo version: $VERSION"  grep -r "Host_Alias" /etc/sudoers* | grep -v "^#"else  echo "✅  Safe Sudo version: $VERSION"fi
```  
## 5. 附录CVE-2025-32463 漏洞详情：https://www.stratascale.com/vulnerability-alert-CVE-2025-32462-sudo-host注意：本手册仅供安全研究人员和系统管理员参考，未经授权禁止在真实环境中测试漏洞。  
  
  
